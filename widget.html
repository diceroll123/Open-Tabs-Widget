<html>
  <head>
    <link rel="stylesheet" type="text/css" href="styles.css" />
  </head>

  <body>
    <script type="text/javascript" src="jquery-1.7.2.js"></script>
    <script type="text/javascript">
      $(document).ready(function($) {

        function restyle() {
          var width  = $(window).width() ,
              height = $(window).height();

          $("body").css({
            "width" : width,
            "height": height
          });
          $(".tab-link").css({
            "width" : width - 63
          });
        }

        // Handles when the widget is resized
        restyle();
        $(window).bind("resize", function() {
          restyle();
        });

        $(window).bind('storage', function (e) {
          if ( typeof(e.originalEvent) === "object"
          && typeof(e.originalEvent.key) === "string"
          && e.originalEvent.key === "open_tabs" ) {
            createList();
          }
        });
        createList();

        function createList() {
          var open_tabs = JSON.parse(localStorage.getItem("open_tabs"));
          $("#tabs").html("");
          $.each(open_tabs, function(id, tab) {
            if ( tab.incognito === false && tab.status == "complete" ) {
              var open_temp = $("<div></div>").addClass("tab-item");
              $("<img></img>").appendTo(open_temp).addClass("tab-icon")
              .attr({
                "src": tab.favIconUrl,
                "height": 16,
                "width": 16
              });
              $("<div></div>").appendTo(open_temp).addClass("tab-link").html( tab.title ).attr("id", tab.id);
			  var pin = $("<span></span>").attr("id", tab.id).addClass("tabbutton");
			  if (tab.pinned === false) {
				pin.appendTo(open_temp).html( "<img src='/images/pin.png'>" ).addClass("pin");
			  } else {
				pin.appendTo(open_temp).html( "<img src='/images/redpin.png'>" ).addClass("unpin");
			  }
              $("<span></span>").appendTo(open_temp).html( "<img src='/images/cancel.png'>" ).attr("id", tab.id).addClass("tabbutton close");
              open_temp.appendTo("#tabs");
            }
          });

          restyle();
        }

        $(".tab-link").live("click", function () {
          localStorage.setItem("switch_to_tab", $(this).attr("id"));
        });

        $(".close").live("click", function () {
          localStorage.setItem("close_tab", $(this).attr("id"));
        });

        $(".pin").live("click", function () {
          localStorage.setItem("pin_tab", $(this).attr("id"));
        });

        $(".unpin").live("click", function () {
          localStorage.setItem("unpin_tab", $(this).attr("id"));
        });
      });
    </script>

    <div id="tabs"></div>
  </body>
</html>